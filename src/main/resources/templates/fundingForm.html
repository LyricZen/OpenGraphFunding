<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funding Form</title>

    <!-- jQuery 라이브러리 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<h1>Funding Form - Product Link</h1>

<form id="linkForm">
    <label for="productLink">Product Link:</label>
    <input type="text" id="productLink" name="productLink" required>
    <button type="button" onclick="previewProduct()">상품 등록</button>
    <button type="button" onclick="clearPreview()">상품 삭제</button>
</form>

<hr>

<!-- Display preview product information -->
<h2>Preview Product Information:</h2>
<div id="previewProductInfo"></div>

<form id="fundingForm" action="/funding/saveToDatabase" method="post">
    <!-- Input fields for funding details -->
    <label for="title">Funding 제목:</label>
    <input type="text" id="title" name="title" required>
    <br>
    <label for="content">Funding 내용:</label>
    <input type="text" id="content" name="content" required>
    <br>
    <label for="goalAmount">목표 금액:</label>
    <input type="number" id="goalAmount" name="goalAmount" step="1" required>
    <br>
    <button type="submit">Save Funding</button>
</form>

<script th:inline="javascript">
    function previewProduct() {
        var productLink = $("#productLink").val();
        if (productLink) {
            // AJAX request to the server for preview product information
            $.ajax({
                type: "POST",
                url: "/funding/previewProduct",
                data: { productLink: productLink },
                dataType: "json",
                success: function (data) {
                    // Show the preview product information if available
                    if (data && data.productLink && data.productName && data.productImage) {
                        var previewSection = $("#previewProductInfo");
                        previewSection.html("<h3>Preview Product Information:</h3>" +
                            "<p>Product Link: " + data.productLink + "</p>" +
                            "<p>Product Name: " + data.productName + "</p>" +
                            "<p>Product Image: <img src='" + data.productImage + "' alt='Product Image'></p>");

                        // Store product information in the cache
                        $.post("/funding/saveToCache", { productLink: productLink });
                    } else {
                        alert("Failed to fetch product information. Please try again.");
                    }
                }
            });
        }
    }

    function clearPreview() {
        // Clear the preview section
        $("#previewProductInfo").empty();
        // Clear the product link
        $("#productLink").val("");

        // Clear the cached product information
        $.post("/funding/clearCachedProduct");
    }
</script>
</body>
</html>